<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Weather Pro Indonesia</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
    margin:0;
    font-family:Arial, sans-serif;
    color:white;
    overflow-x:hidden;
    transition:background 1.5s;
    background:linear-gradient(#4facfe,#00f2fe);
}

/* ===== SKY OBJECT ===== */
#sun,#moon{
    position:fixed;
    top:30px;
    right:30px;
    width:90px;
    height:90px;
    border-radius:50%;
    display:none;
    z-index:0;
}
#sun{
    background:radial-gradient(circle,#fff700,#ffaa00);
    box-shadow:0 0 20px #ffd700;
}
#moon{
    background:#eee;
    box-shadow:0 0 20px #ccc;
}

/* ===== CLOUD ===== */
.cloud{
    position:fixed;
    width:180px;
    height:70px;
    background:white;
    border-radius:50px;
    opacity:0.25;
    animation:cloudMove linear infinite;
    z-index:-2;
}
.cloud::before,.cloud::after{
    content:"";
    position:absolute;
    background:white;
    width:80px;
    height:80px;
    border-radius:50%;
    top:-35px;
}
.cloud::before{left:25px;}
.cloud::after{right:25px;}
@keyframes cloudMove{
    from{left:-250px;}
    to{left:120%;}
}

/* ===== RAIN ===== */
#rain{
    position:fixed;
    width:100%;
    height:100%;
    display:none;
    pointer-events:none;
    z-index:-1;
}
.drop{
    position:absolute;
    width:2px;
    height:15px;
    background:rgba(255,255,255,0.6);
    animation:fall linear infinite;
}
@keyframes fall{
    to{transform:translateY(100vh);}
}

/* ===== LIGHTNING ===== */
#lightning{
    position:fixed;
    width:100%;
    height:100%;
    background:white;
    opacity:0;
    pointer-events:none;
    z-index:5;
    transition:opacity 0.1s;
}

/* ===== UI ===== */
.menu-bar{display:flex;gap:6px;padding:10px;}
.menu-container{position:relative;}
button{
    background:#2196f3;
    color:white;
    border:none;
    border-radius:12px;
    padding:8px 14px;
    font-weight:bold;
}
.dropdown{
    position:absolute;
    top:45px;
    background:#1c3552;
    border-radius:12px;
    display:none;
    overflow:hidden;
}
.dropdown button{width:100%;background:none;text-align:left;}
.dropdown button:hover{background:#2196f3;}

input{
    flex:1;
    border:none;
    border-radius:12px;
    padding:10px;
}

.screen{display:none;padding:10px;}
.screen.active{display:block;}

.card{
    background:rgba(0,0,0,0.35);
    border-radius:18px;
    padding:15px;
    margin-bottom:14px;
}

.scroll{
    display:flex;
    gap:8px;
    overflow-x:auto;
}

.item{
    min-width:90px;
    background:rgba(0,0,0,0.45);
    border-radius:14px;
    padding:10px;
    text-align:center;
}

.warning{
    background:#2b4666;
    border-left:5px solid #ffcc00;
    border-radius:10px;
    padding:10px;
    margin-bottom:10px;
}
.warning h4{margin:0;color:#ffcc00;}
</style>
</head>
<body>

<div id="sun"></div>
<div id="moon"></div>
<div id="rain"></div>
<div id="lightning"></div>

<div class="cloud" style="top:80px;animation-duration:140s;"></div>
<div class="cloud" style="top:150px;animation-duration:180s;"></div>

<!-- ===== DASHBOARD ===== -->
<div id="dashboard" class="screen active">
    <div class="menu-bar">
        <div class="menu-container">
            <button onclick="toggleMenu('m1')">Menu</button>
            <div id="m1" class="dropdown">
                <button onclick="goDashboard()">Dashboard</button>
                <button onclick="goStats()">Statistik</button>
                <button onclick="goDanger()">Daerah Rawan Bencana</button>
            </div>
        </div>
        <input id="cityInput" placeholder="Cari kota...">
        <button onclick="searchCity()">Cari</button>
    </div>

    <div class="card">
        <h2 id="city">Mendeteksi lokasi...</h2>
        <h1 id="temp">-- ¬∞C</h1>
        <div id="desc"></div>
        <div id="clock"></div>
    </div>

    <div class="card">
        <h3>Prediksi Hari Ini (00:00 ‚Äì 23:00)</h3>
        <div id="hourly" class="scroll"></div>
    </div>

    <div class="card">
        <h3>Prediksi 5 Hari</h3>
        <div id="daily" class="scroll"></div>
    </div>
</div>

<!-- ===== STATS ===== -->
<div id="stats" class="screen">
    <div class="menu-bar">
        <div class="menu-container">
            <button onclick="toggleMenu('m2')">Menu</button>
            <div id="m2" class="dropdown">
                <button onclick="goDashboard()">Dashboard</button>
                <button onclick="goStats()">Statistik</button>
                <button onclick="goDanger()">Daerah Rawan Bencana</button>
            </div>
        </div>
    </div>

    <div class="card" id="statBox"></div>
    <div class="card">
        <h3>‚ö†Ô∏è Peringatan & Edukasi Bencana</h3>
        <div id="warningBox"></div>
    </div>
</div>

<!-- ===== DANGER ZONES ===== -->
<div id="danger" class="screen">
    <div class="menu-bar">
        <div class="menu-container">
            <button onclick="toggleMenu('m3')">Menu</button>
            <div id="m3" class="dropdown">
                <button onclick="goDashboard()">Dashboard</button>
                <button onclick="goStats()">Statistik</button>
                <button onclick="goDanger()">Daerah Rawan Bencana</button>
            </div>
        </div>
    </div>
    <div class="card">
        <h3>Daerah Rawana Bencana di Indonesia</h3>
        <div class="scroll" id="dangerList"></div>
    </div>
</div>

<script>
const API_KEY="bbc75e5ff6f517935e16293103ded9dc";
const EMERGENCY_API="https://api.open-meteo.com/v1/forecast";
let lat=null,lon=null,tempVal=0,hum=0,wind=0,press=0,weatherText="";
let cityName="Mendeteksi lokasi...";

/* ===== CLOCK ===== */
setInterval(()=>{
    const now=new Date();
    clock.innerText=now.toLocaleTimeString("id-ID");
    updateDayNight(now.getHours());
},1000);

/* ===== MENU ===== */
function toggleMenu(id){
    document.querySelectorAll(".dropdown").forEach(d=>d.style.display="none");
    document.getElementById(id).style.display="block";
}
document.addEventListener("click",e=>{
    if(!e.target.closest(".menu-container")){
        document.querySelectorAll(".dropdown").forEach(d=>d.style.display="none");
    }
});
function goDashboard(){dashboard.classList.add("active");stats.classList.remove("active");danger.classList.remove("active");}
function goStats(){dashboard.classList.remove("active");stats.classList.add("active");danger.classList.remove("active");updateStats();}
function goDanger(){dashboard.classList.remove("active");stats.classList.remove("active");danger.classList.add("active");updateDanger();}

/* ===== GPS ===== */
if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(p=>{
        lat=p.coords.latitude; lon=p.coords.longitude;
        loadWeather(lat,lon,true);
    },()=>loadWeather(-6.2,106.8,false));
}else loadWeather(-6.2,106.8,false);

/* ===== SEARCH ===== */
function searchCity(){
    if(cityInput.value){
        loadWeatherByCity(cityInput.value);
        cityInput.value="";
    }
}

/* ===== EFFECTS ===== */
function rainEffect(on){
    rain.style.display=on?"block":"none";
    rain.innerHTML="";
    if(on){
        for(let i=0;i<160;i++){
            let d=document.createElement("div");
            d.className="drop";
            d.style.left=Math.random()*100+"%";
            d.style.animationDuration=(0.4+Math.random())+"s";
            rain.appendChild(d);
        }
    }
}
function lightningFlash(){
    lightning.style.opacity=1;
    setTimeout(()=>lightning.style.opacity=0,120);
}

/* ===== DAY NIGHT ===== */
function updateDayNight(h){
    const day=h>=6&&h<18;
    sun.style.display=day?"block":"none";
    moon.style.display=!day?"block":"none";
    document.body.style.background=day?
    "linear-gradient(#4facfe,#00f2fe)":
    "linear-gradient(#0f2027,#203a43,#2c5364)";
}

/* ===== WEATHER ===== */
async function loadWeather(lat,lon,useCityName){
    try{
        const r=await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=id`);
        const d=await r.json();
        if(d.cod===200){
            cityName=d.name;
            document.getElementById("city").innerText=cityName;
            processWeather(d);
            loadForecastOpenWeather(d.name);
        }else{
            loadEmergencyForecast(lat,lon);
        }
    }catch{
        loadEmergencyForecast(lat,lon);
    }
}

async function loadWeatherByCity(name){
    try{
        const r=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${name}&appid=${API_KEY}&units=metric&lang=id`);
        const d=await r.json();
        if(d.cod===200){
            cityName=d.name;
            document.getElementById("city").innerText=cityName;
            processWeather(d);
            loadForecastOpenWeather(name);
        }else{
            cityName=name;
            document.getElementById("city").innerText=cityName;
            loadEmergencyForecast(-6.2,106.8);
        }
    }catch{
        cityName=name;
        document.getElementById("city").innerText=cityName;
        loadEmergencyForecast(-6.2,106.8);
    }
}

function processWeather(d){
    tempVal=Math.round(d.main.temp);
    temp.innerText=tempVal+" ¬∞C";
    desc.innerText=d.weather[0].description;
    weatherText=d.weather[0].description;
    hum=d.main.humidity;
    wind=d.wind.speed;
    press=d.main.pressure;
    if(weatherText.includes("hujan")){
        rainEffect(true);
        if(weatherText.includes("petir")) lightningFlash();
    }else rainEffect(false);
}

/* ===== FORECAST OPENWEATHER ===== */
async function loadForecastOpenWeather(city){
    try{
        const r=await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${API_KEY}&units=metric&lang=id`);
        const d=await r.json();
        if(d.cod==="200") renderForecastOpenWeather(d);
        else loadEmergencyForecast(lat,lon);
    }catch{
        loadEmergencyForecast(lat,lon);
    }
}

function renderForecastOpenWeather(d){
    hourly.innerHTML="";
    daily.innerHTML="";
    const today=new Date().toISOString().split("T")[0];
    let map={};
    let used=new Set();
    d.list.forEach(i=>{
        const [dt,tm]=i.dt_txt.split(" ");
        const h=parseInt(tm.slice(0,2));
        if(dt===today) map[h]={t:Math.round(i.main.temp),d:i.weather[0].description};
        const day=new Date(i.dt_txt).getDate();
        if(!used.has(day)){
            used.add(day);
            const da=new Date(i.dt_txt);
            daily.innerHTML+=`
            <div class="item">
            ${da.toLocaleDateString("id-ID",{weekday:"short",day:"2-digit",month:"short"})}<br>${Math.round(i.main.temp)}¬∞C<br>${i.weather[0].description}
            </div>`;
        }
    });
    let last=null;
    for(let h=0;h<24;h++){
        if(map[h]) last=map[h];
        hourly.innerHTML+=`
        <div class="item">
        ${String(h).padStart(2,"0")}:00<br>${last?last.t+"¬∞C":"--"}<br>${last?last.d:"Memuat"}
        </div>`;
    }
}

/* ===== EMERGENCY FORECAST ===== */
async function loadEmergencyForecast(lat,lon){
    try{
        const r=await fetch(`${EMERGENCY_API}?latitude=${lat}&longitude=${lon}&hourly=temperature_2m`);
        const d=await r.json();
        tempVal=d.hourly.temperature_2m[0];
        temp.innerText=tempVal+" ¬∞C";
        desc.innerText="Data Open-Meteo";
        renderEmergencyHourly(d);
    }catch(e){
        console.log("Open-Meteo error",e);
    }
}

function renderEmergencyHourly(d){
    hourly.innerHTML="";
    for(let h=0;h<24;h++){
        let t=d.hourly.temperature_2m[h]||"--";
        hourly.innerHTML+=`
        <div class="item">
        ${String(h).padStart(2,"0")}:00<br>${t}¬∞C<br>Memuat
        </div>`;
    }
    daily.innerHTML="";
    for(let i=0;i<5;i++){
        const now=new Date();
        now.setDate(now.getDate()+i);
        daily.innerHTML+=`
        <div class="item">
        ${now.toLocaleDateString("id-ID",{weekday:"short",day:"2-digit",month:"short"})}<br>-- ¬∞C<br>Memuat
        </div>`;
    }
}

/* ===== STATS & WARNING ===== */
function updateStats(){
    statBox.innerHTML=`
    üå°Ô∏è Suhu: ${tempVal} ¬∞C<br>
    üíß Kelembapan: ${hum}%<br>
    üí® Angin: ${wind} m/s<br>
    üß≠ Tekanan: ${press} hPa
    `;
    let w="";
    if(tempVal>=35) w+=warn("Panas Ekstrem","Risiko dehidrasi","Minum air & hindari panas");
    if(weatherText.includes("hujan")) w+=warn("Banjir","Hujan lebat","Pantau sungai");
    if(weatherText.includes("petir")) w+=warn("Petir","Bahaya sambaran","Hindari lapangan");
    if(wind>=10) w+=warn("Angin Kencang","Pohon tumbang","Amankan barang");
    w+=warn("Gempa","Indonesia rawan gempa","Kenali titik aman");
    warningBox.innerHTML=w;
}
function warn(t,d,a){
    return `<div class="warning"><h4>${t}</h4>${d}<br><b>Yang harus dilakukan:</b> ${a}</div>`;
}

/* ===== DANGER LIST ===== */
function updateDanger(){
    const zones=[
        {kota:"Jakarta",bencana:"Banjir, Gempa",tips:"Waspada banjir dan lokasi evakuasi"},
        {kota:"Bandung",bencana:"Landslide, Gempa",tips:"Hindari daerah rawan longsor"},
        {kota:"Surabaya",bencana:"Banjir, Angin Kencang",tips:"Pantau sungai dan pohon besar"},
        {kota:"Medan",bencana:"Banjir, Gempa",tips:"Kenali titik evakuasi"},
        {kota:"Makassar",bencana:"Angin Kencang, Gempa",tips:"Amankan barang berharga"},
        {kota:"Denpasar",bencana:"Banjir, Angin Kencang",tips:"Waspada banjir dan pohon tumbang"},
        {kota:"Yogyakarta",bencana:"Gempa",tips:"Kenali lokasi aman saat gempa"},
        {kota:"Palembang",bencana:"Banjir, Angin Kencang",tips:"Hindari daerah rendah saat hujan"},
        {kota:"Semarang",bencana:"Banjir, Gempa",tips:"Pantau sungai dan lokasi evakuasi"},
        {kota:"Aceh",bencana:"Gempa, Tsunami",tips:"Siapkan jalur evakuasi ke dataran tinggi"}
    ];
    dangerList.innerHTML="";
    zones.forEach(z=>{
        const div=document.createElement("div");
        div.className="item";
        div.innerHTML=`<b>${z.kota}</b><br>${z.bencana}<br>${z.tips}`;
        dangerList.appendChild(div);
    });
}
</script>
</body>
</html>
